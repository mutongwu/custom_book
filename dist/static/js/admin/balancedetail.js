$(function(){function e(e){new App.DatePicker({el:$(".j_date"),val:e,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",onUpdate:function(){r.validate($(".j_date"))}})}function t(){var e=r.validate();if(!e.FAILED){e.statementTime&&(e.statementTime=new Date(e.statementTime).getTime());var t=$.extend(m,e,{call:"admin.commitStatement",status:1});delete t._statusTxt,delete t.createTime,delete t.updateTime,App.onceAjax({method:"POST",data:t}).done(function(e){sessionStorage.setItem("BALANCE_DETAIL",JSON.stringify(e)),App.tip("结算记录更新成功")}).fail(function(e){App.tip(e&&e.message,"error")})}}function n(e){return App.onceAjax({data:{call:"admin.getAccountVo",userId:e}}).then(function(e){return e?(a(e),void s.find("#j_submit").removeClass("disable")):(App.tip("查找用户信息失败,请确认用户ID填写正确","error"),!1)},function(e){return App.tip(e&&e.message||"查找用户账户信息失败","error"),!1})}function a(e){for(var t in e)o.find('[name="'+t+'"]').val(e[t])}function i(t){e(t.statementTime),a(t)}var s=$(".adminBalanceDetailCnt"),o=s.find(".balanceForm"),r=(App.params(),new App.FormValidator({$form:o})),m=sessionStorage.getItem("BALANCE_DETAIL");s.on("click","#j_submit",function(){var e=$(this);e.hasClass("disable")||t()}).on("blur",".j_userId",function(){var e=$(this),t=e.val();/^\d+$/.test(t)&&(n(t).then(function(t){t===!1&&setTimeout(function(){r.setInvalid(e,"用户ID不正确")},0)}),s.find("#j_submit").addClass("disable"))}),m&&(m=JSON.parse(m),i(m))});