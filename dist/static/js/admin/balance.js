$(function(){function e(e,t){f||(f=new App.PageBar({el:$("#j_pageBox"),cls:"ui_pageBar_L",totalNum:e.count,jumpTo:!1,onPage:function(e){t.pageNo=e,n(t)}}))}function t(){f&&(f.destroy(),f=null)}function n(t){App.ajax({data:t}).done(function(n){n&&n.list&&n.list.length?(c=n.list,$.each(n.list,function(e,t){t._statusTxt=l[t.status+""]}),r.find(".j_tbdBox").html(template("itemTpl",n)),e(n,t)):r.find(".j_tbdBox").html('<tr><td colspan="'+r.find("thead th").length+'"><p class="tc">暂无结算信息~</p></td></tr>')}).fail(function(e){App.tip(e&&e.message,"error")}),m=t}function a(){var e="";$.each(l,function(t,n){e+='<option value="'+t+'">'+n+"</option>"}),r.find(".j_balanceStatusSel").append(e)}function i(){var e=r.find(".j_beginTime"),t=r.find(".j_endTime"),n=new Date,a=new Date;n.setDate(n.getDate()-7);new App.DatePicker({el:e,val:n,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",beforeEl:t}),new App.DatePicker({el:t,val:a,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",afterEl:e})}function o(e){var t={};for(var n in e)""!==e[n]&&(t[n]=e[n]);return t}var l={0:"结算中",1:"已结算"},c=null,r=$(".adminBalanceCnt"),s=new App.FormValidator({$form:r.find(".queryForm")}),d={call:"admin.listStatementVo",pageNo:1,pageSize:10},m=null,f=null;r.on("click",".j_queryBtn",function(){var e=s.validate();e.beginTime&&(e.beginTime=new Date(e.beginTime).getTime()),e.endTime&&(e.endTime=new Date(e.endTime).getTime()),n($.extend({},d,o(e))),t()}).on("click",".j_accept",function(){var e=$(this).closest("tr").data("idx");sessionStorage.setItem("BALANCE_DETAIL",JSON.stringify(c[e])),location.href="./balancedetail.jsp"}),i(),a()});