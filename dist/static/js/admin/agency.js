$(function(){function n(n,e){u||(u=new App.PageBar({el:$("#j_pageBox"),cls:"ui_pageBar_L",totalNum:n.count,jumpTo:!1,onPage:function(n){e.pageNo=n,i(e)}}))}function e(){u&&(u.destroy(),u=null)}function t(){i(m)}function i(e){App.ajax({data:e}).done(function(t){t&&t.list&&t.list.length?(l.find(".j_tbdBox").html(template("itemTpl",t)),n(t,e)):l.find(".j_tbdBox").html('<tr><td colspan="'+l.find("thead th").length+'"><p class="tc">暂无代理~</p></td></tr>')}).fail(function(n){App.tip(n&&n.message,"error")}),m=e}function a(){var n="";$.each(c,function(e,t){n+='<option value="'+e+'">'+t+"</option>"}),l.find(".j_agencyStatus").append(n)}function o(){var n=l.find(".j_beginTime"),e=l.find(".j_endTime"),t=new Date,i=new Date;t.setDate(t.getDate()-7);new App.DatePicker({el:n,val:t,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",beforeEl:e}),new App.DatePicker({el:e,val:i,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",afterEl:n})}function r(n){var e={};for(var t in n)""!==n[t]&&(e[t]=n[t]);return e}function p(n,e){new App.LightBox({type:"confirm",title:"填写("+(e?"通过":"不通过")+")审核意见",msg:$("#popFormTpl").html(),msgType:"none",timeout:null,confirmFn:function(){var i=new App.FormValidator({$form:l.find(".popForm")}),a=i.validate();if(!a.FAILED){var o=$.extend({call:e?"admin.approvePartnerInfo":"admin.disagreePartnerInfo",partnerInfoId:n},a);App.onceAjax({data:o}).done(function(n){1==n?(App.tip("申请信息审核成功！"),t()):App.tip("申请信息审核失败！","error")}).fail(function(n){App.tip(n&&n.message||"申请信息审核失败！","error")})}}}).show()}var c={"-2":"停止合作","-1":"不通过",0:"待审核",1:"审核通过"},l=$(".adminAgencyCnt"),d=new App.FormValidator({$form:l.find(".queryForm")}),f={call:"admin.listPartnerInfo",pageNo:1,pageSize:10},m=null,u=null;l.on("click",".j_queryBtn",function(){var n=d.validate();n.beginTime&&(n.beginTime=new Date(n.beginTime).getTime()),n.endTime&&(n.endTime=new Date(n.endTime).getTime()),i($.extend({},f,r(n))),e()}).on("click",".j_accept",function(){var n=$(this).closest("tr"),e=n.data("id");p(e,!0)}).on("click",".j_deny",function(){var n=$(this).closest("tr"),e=n.data("id");p(e,!1)}).on("click",".j_lock",function(){var n=$(this).closest("tr"),e=n.data("uid");App.confirm("确定终止用户["+e+"]的合作伙伴关系吗？",function(){App.onceAjax({call:"admin.discontinuePartnerInfo",userId:e}).done(function(n){n>0?(App.tip("停止合作操作成功！"),t()):App.tip("停止合作操作失败！","error")}).fail(function(n){App.tip(n&&n.message||"停止合作操作失败！","error")})})}),o(),a(),$(".j_distinctSelect").distpicker()});