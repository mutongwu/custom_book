$(function(){function e(e,n){m||(m=new App.PageBar({el:$("#j_pageBox"),cls:"ui_pageBar_L",totalNum:e.count,jumpTo:!1,onPage:function(e){n.pageNo=e,a(n)}}))}function n(){m&&(m.destroy(),m=null)}function t(){a(f)}function a(n){App.ajax({data:n}).done(function(t){t&&t.list&&t.list.length?(r.find(".j_tbdBox").html(template("itemTpl",t)),e(t,n)):r.find(".j_tbdBox").html('<tr><td colspan="'+r.find("thead th").length+'"><p class="tc">暂无返利信息~</p></td></tr>')}).fail(function(e){App.tip(e&&e.message,"error")}),f=n}function i(){var e="";$.each(p,function(n,t){e+='<option value="'+n+'">'+t+"</option>"}),r.find(".j_rebateStatusSel").append(e)}function o(){var e=r.find(".j_beginTime"),n=r.find(".j_endTime"),t=new Date,a=new Date;t.setDate(t.getDate()-7);new App.DatePicker({el:e,val:t,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",beforeEl:n}),new App.DatePicker({el:n,val:a,hasTime:!0,format:"yyyy-MM-dd hh:mm:ss",afterEl:e})}function l(e){var n={};for(var t in e)""!==e[t]&&(n[t]=e[t]);return n}var p={0:"未提现",1:"已提现",2:"退货退款"},r=$(".adminRebateCnt"),c=new App.FormValidator({$form:r.find(".queryForm")}),d={call:"admin.listRebateDetailVo",pageNo:1,pageSize:10},f=null,m=null;r.on("click",".j_queryBtn",function(){var e=c.validate();e.beginTime&&(e.beginTime=new Date(e.beginTime).getTime()),e.endTime&&(e.endTime=new Date(e.endTime).getTime()),a($.extend({},d,l(e))),n()}).on("click",".j_doRebate",function(){var e=r.find(".rebateIds:checked");if(!e.length)return App.tip("请勾选要提现的记录。","warn");var n=[];$.each(e,function(){n.push(this.value)}),App.confirm("确定提现勾选的"+n.length+"条记录吗？",function(){App.onceAjax({data:{call:"admin.statementRebateDetail",rebateDetailIds:n.join(",")}}).done(function(e){e&&(App.tip("提现操作成功。"),t())}).fail(function(e){App.tip(e&&e.message,"error")})})}),o(),i()});