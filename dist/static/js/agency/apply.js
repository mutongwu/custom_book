$(function(){function t(t){switch(+t){case 1:return"个人代理";case 2:return"网店代理";case 3:return"实体店代理"}}function e(e){d.addClass("none"),d.filter('[level="'+e+'"]').removeClass("none"),r.find(".j_typeName").text(t(e)),currentValidator=f[e+""]}function a(){var t=currentValidator.validate(),e=null;if(!t.FAILED&&(e=u.validate(),!e.FAILED)){var a=$.extend({level:r.find(".j_typeRadio:checked").val(),call:"agent.applyAgent"},t,e);return a.pic1&&a.pic2&&a.pic3&&(a.attachmentIds=[a.pic1,a.pic2,a.pic3].join(","),delete a.pic1,delete a.pic2,delete a.pic3),"1"==a.level||a.attachmentIds?void App.onceAjax({data:a,method:"POST"}).done(function(){App.tip("申请成功，请等待审核")}).fail(function(t){App.tip(t&&t.message,"error")}):App.tip("请先上传3张店铺(网店)图片资料","error")}}function n(){return App.ajax({data:{call:"agent.getApplyAgentInfo"}})}function i(){var t=r.find(".uploadInput");t.fileupload({url:"/book/u/f.do",formData:{call:"attachment.upload"},dataType:"json",done:function(t,e){var a=$(t.target),n=e.result;a.siblings(".pic").attr("src","/book/u/s.do?attachmentId="+n.data),a.siblings(".attachmentId").val(n.data)}})}function c(t){var e=t.partnerInfoVo,a=Number(e.level);r.find('.j_typeRadio[value="'+a+'"]').click();for(var n in e)l.find('[name="'+n+'"]').val(e[n]);l.find(".j_distSelect").distpicker({province:e.contactProvince,city:e.contactCity,district:e.contactCounty});var i=d.eq(a-1);for(var n in e)i.find('[name="'+n+'"]').val(e[n]);i.find(".j_distSelect").distpicker({province:e.province,city:e.city,district:e.county}),d.not(a-1).find(".j_distSelect").distpicker(),a>1&&$.each(t.picInfoVoList,function(t,e){i.find(".attachmentId").filter('[name="pic'+(t+1)+'"]').val(e.attachmentId).siblings(".pic").attr("src","/book/u/s.do?attachmentId="+e.attachmentId)}),0==e.status&&r.find(".j_status").text("等待审核中").closest(".ui-form-item").removeClass("none")}function o(){n().done(function(t){t?c(t):(r.find('.j_typeRadio[value="'+s+'"]').click(),$(".j_distSelect").distpicker())})}var r=$(".applyCnt"),d=r.find(".j_applyLevelBox"),l=r.find(".j_contactBox"),p=App.params(),s=1,f={1:new App.FormValidator({$form:d.eq(0)}),2:new App.FormValidator({$form:d.eq(1)}),3:new App.FormValidator({$form:d.eq(2)})},u=new App.FormValidator({$form:l});r.on("change",".j_typeRadio",function(){var t=$(this).val();this.checked&&(s=t,e(t))}).on("click","#j_submit",function(){$(this).hasClass("disable")||a()}),/^([123])$/.test(p.level)&&(s=RegExp.$1),o(),i()});