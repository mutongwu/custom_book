$(function(){function e(e){var i=l.validate();if(!i.FAILED){if(i.userPwd!==i.userPwd2)return void App.tip("密码输入不一致","error");i.call=o[e].api,"mobile"===e?delete i.email:delete i.mobile,App.ajax({data:i,method:"POST"}).done(function(){App.alert("您的账号已注册成功，请前往登陆页面登陆！",function(){App.linkTo("/login/login.jsp")},"success")}).fail(function(e){App.tip(e&&e.message,"error")})}}function i(e){function i(){a>1?(e.html("请等待"+a+"秒再获取"),a-=1):t(n,e)}var a="mobile"===s?60:30,n=setInterval(i,1e3);return i(),n}function t(e,i){clearInterval(e),i.html("获取").removeClass("disable")}function a(e){var a=n.find(o[s].el),r=l.validateField(a[0]);if(r===!0){var p={call:o[s].checkApi};p[s]=a.val(),App.onceAjax({data:p}).done(function(e){return 1==e&&App.alert("此手机已注册账号，请去取回密码进行登录。",function(){App.linkTo("/login/findPwd.jsp")}),!1}).fail(function(e){App.tip(e&&e.message,"error")}).then(function(l){if(l===!1){e.addClass("disable");var r=i(e),p={call:o[s].codeApi};p[s]=a.val(),App.ajax({data:p,method:"POST"}).done(function(e){App.tip(o[s].tip),n.find(".j_verificationId").val(e.verificationId)}).fail(function(i){App.tip(i&&i.message,"error"),t(r,e)})}})}else l.setInvalid(a[0],r)}var n=$(".registerForm"),l=new App.FormValidator({$form:n}),o={mobile:{api:"user.mobileRegiste",codeApi:"user.getSmsCode",tip:"验证码已发送，请留意您的手机短信",el:".j_phone",checkApi:"user.isMobileExists"},email:{api:"user.emailRegiste",codeApi:"user.getEmailCode",tip:"验证码已发送，请前往您的邮箱查阅",el:".j_email",checkApi:"user.isEmailExists"}},s="mobile";n.on("click",".ui-tab .tabItem",function(){var e=$(this);s=e.attr("type"),e.addClass("active").siblings().removeClass("active"),n.find(".j_email,.j_phone").toggleClass("disable"),n.find(".phoneRegister, .emailRegister").toggleClass("none")}).on("click","#j_submit",function(){s=$(".ui-tab .tabItem.active").attr("type"),e(s)}).on("click",".j_getCode",function(){var e=$(this);e.hasClass("disable")||a(e)})});