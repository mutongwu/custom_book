$(function(){function e(e){function o(){n>1?(e.html("请等待"+n+"秒再获取"),n-=1):i(t,e)}var n=30,t=setInterval(o,1e3);return o(),t}function i(e,i){clearInterval(e),i.html("获取").removeClass("disable")}function o(e,i){a.hide(),s.show(),u=e,d=i}function n(o){o.addClass("disable");var n=e(o),t={call:l[d].codeApi};t[d]=u,App.ajax({data:t,method:"POST"}).done(function(e){App.tip(l[d].tip),s.find(".j_verificationId").val(e.verificationId)}).fail(function(e){App.tip(e&&e.message,"error"),i(n,o)})}function t(){var e=c.validate();e.FAILED||(c.isEmail(e.source)?App.onceAjax({data:{call:"user.isEmailExists",email:e.source},method:"POST"}).done(function(i){i?o(e.source,"email"):App.tip(i&&i.message||"账号不存在","error")}).fail(function(e){App.tip(e&&e.message,"error")}):c.isPhone(e.source)?App.onceAjax({data:{call:"user.isMobileExists",mobile:e.source},method:"POST"}).done(function(i){i?o(e.source,"mobile"):App.tip(i&&i.message||"账号不存在","error")}).fail(function(e){App.tip(e&&e.message,"error")}):App.tip("账号格式不正确，请您填写注册时的手机号或邮箱。","error"))}function r(){var e=p.validate();if(!e.FAILD){if(e.userPwd!==e.userPwd2)return void App.tip("密码输入不一致","error");e.call="user.resetPwd",e.source=u,App.onceAjax({data:e,method:"POST"}).done(function(){App.alert("您的密码已重置成功，请前往登陆页面登陆！",function(){App.linkTo("/login/login.jsp")},"success")}).fail(function(e){App.tip(e&&e.message,"error")})}}var a=$(".existForm"),s=$(".findPwdForm"),c=new App.FormValidator({$form:a}),p=new App.FormValidator({$form:s}),l={mobile:{codeApi:"user.getSmsCode",tip:"验证码已发送，请留意您的手机短信"},email:{codeApi:"user.getEmailCode",tip:"验证码已发送，请前往您的邮箱查阅"}},u=null,d=null;$(".findPwdCnt").on("click","#j_checkExist",function(){t()}).on("click",".j_getCode",function(){var e=$(this);e.hasClass("disable")||n(e)}).on("click","#j_submit",function(){r()})});